function shorturl(){""!=document.querySelector("#longURL").value?(document.getElementById("keyPhrase").value=document.getElementById("keyPhrase").value.replace(/\s/g,"-"),document.getElementById("addBtn").disabled=!0,document.getElementById("addBtn").innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Please wait...',fetch(apiSrv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cmd:"add",url:document.querySelector("#longURL").value,key:document.querySelector("#keyPhrase").value,password:password_value})}).then(function(e){return e.json()}).then(function(e){if(res=e,document.getElementById("addBtn").disabled=!1,document.getElementById("addBtn").innerHTML="Shorten it","200"==res.status){let e=res.key,t=document.querySelector("#longURL").value;localStorage.setItem(e,t),addUrlToList(e,t),document.getElementById("result").innerHTML=window.location.protocol+"//"+window.location.host+"/"+res.key}else document.getElementById("result").innerHTML=res.error;var t=new bootstrap.Modal(document.getElementById("resultModal"));t.show()}).catch(function(e){alert("Unknow error. Please retry!"),console.log(e),document.getElementById("addBtn").disabled=!1,document.getElementById("addBtn").innerHTML="Shorten it"})):alert("Url cannot be empty!")}function copyurl(e,t){let n=null;if(t){if(n=document.createElement("div"),n.id="tempTarget",n.style.opacity="0",e){let o=document.querySelector("#"+e);n.innerText=o[t]}else n.innerText=t;document.body.appendChild(n)}else n=document.querySelector("#"+e);try{let e=document.createRange();e.selectNode(n),window.getSelection().removeAllRanges(),window.getSelection().addRange(e),document.execCommand("copy"),window.getSelection().removeAllRanges()}catch(e){console.log("Copy error")}t&&n.parentElement.removeChild(n)}function loadUrlList(){let e=document.querySelector("#urlList");for(;e.firstChild;)e.removeChild(e.firstChild);let t=document.querySelector("#longURL").value,n=localStorage.length;for(;n>0;n--){let e=localStorage.key(n-1),o=localStorage.getItem(e);""!=t&&t!=o||addUrlToList(e,o)}}function addUrlToList(e,t){let n=document.querySelector("#urlList"),o=document.createElement("div");o.classList.add("mb-3","list-group-item");let r=document.createElement("div");r.classList.add("input-group");let l=document.createElement("button");l.setAttribute("type","button"),l.classList.add("btn","btn-danger","rounded-bottom-0"),l.setAttribute("onclick",'deleteShortUrl("'+e+'")'),l.setAttribute("id","delBtn-"+e),l.innerText="X",r.appendChild(l);let d=document.createElement("button");d.setAttribute("type","button"),d.classList.add("btn","btn-info"),d.setAttribute("onclick",'queryVisitCount("'+e+'")'),d.setAttribute("id","qryCntBtn-"+e),d.innerText="?",r.appendChild(d);let a=document.createElement("span");a.classList.add("form-control","rounded-bottom-0"),a.innerText=window.location.protocol+"//"+window.location.host+"/"+e,r.appendChild(a);let s=document.createElement("button");s.setAttribute("type","button"),s.classList.add("btn","btn-info"),s.setAttribute("onclick",'buildQrcode("'+e+'")'),s.setAttribute("id","qrcodeBtn-"+e),s.innerText="QR",r.appendChild(s),o.appendChild(r);let c=document.createElement("div");c.setAttribute("id","qrcode-"+e),o.appendChild(c),o.appendChild(buildValueItemFunc(t)),n.append(o)}function clearLocalStorage(){localStorage.clear()}function deleteShortUrl(e){document.getElementById("delBtn-"+e).disabled=!0,document.getElementById("delBtn-"+e).innerHTML='<span class="spinner-border spinner-border-sm" role="status"></span>',fetch(apiSrv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cmd:"del",key:e,password:password_value})}).then(function(e){return e.json()}).then(function(t){res=t,"200"==res.status?(localStorage.removeItem(e),loadUrlList(),document.getElementById("result").innerHTML="Delete Successful"):document.getElementById("result").innerHTML=res.error;var n=new bootstrap.Modal(document.getElementById("resultModal"));n.show()}).catch(function(e){alert("Unknow error. Please retry!"),console.log(e)})}function queryVisitCount(e){document.getElementById("qryCntBtn-"+e).disabled=!0,document.getElementById("qryCntBtn-"+e).innerHTML='<span class="spinner-border spinner-border-sm" role="status"></span>',fetch(apiSrv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cmd:"qry",key:e+"-count",password:password_value})}).then(function(e){return e.json()}).then(function(t){if(res=t,"200"==res.status)document.getElementById("qryCntBtn-"+e).innerHTML=res.url;else{document.getElementById("result").innerHTML=res.error;var n=new bootstrap.Modal(document.getElementById("resultModal"));n.show()}}).catch(function(e){alert("Unknow error. Please retry!"),console.log(e)})}function query1KV(){let e=document.getElementById("keyForQuery").value;""!=e&&fetch(apiSrv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cmd:"qry",key:e,password:password_value})}).then(function(e){return e.json()}).then(function(t){if(res=t,"200"==res.status)document.getElementById("longURL").value=res.url,document.getElementById("keyPhrase").value=e,document.getElementById("longURL").dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}));else{document.getElementById("result").innerHTML=res.error;var n=new bootstrap.Modal(document.getElementById("resultModal"));n.show()}}).catch(function(e){alert("Unknow error. Please retry!"),console.log(e)})}function loadKV(){clearLocalStorage(),fetch(apiSrv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cmd:"qryall",password:password_value})}).then(function(e){return e.json()}).then(function(e){if(res=e,"200"==res.status)res.kvlist.forEach(e=>{keyPhrase=e.key,valueLongURL=e.value,localStorage.setItem(keyPhrase,valueLongURL)});else{document.getElementById("result").innerHTML=res.error;var t=new bootstrap.Modal(document.getElementById("resultModal"));t.show()}}).catch(function(e){alert("Unknow error. Please retry!"),console.log(e)})}function buildQrcode(e){var t={render:"canvas",minVersion:1,maxVersion:40,ecLevel:"Q",left:0,top:0,size:256,fill:"#000",background:null,text:window.location.protocol+"//"+window.location.host+"/"+e,radius:0,quiet:0,mode:0,mSize:.1,mPosX:.5,mPosY:.5,label:"no label",fontname:"sans",fontcolor:"#000",image:null};$("#qrcode-"+e.replace(/(:|\.|\[|\]|,|=|@)/g,"\\$1").replace(/(:|\#|\[|\]|,|=|@)/g,"\\$1")).empty().qrcode(t)}function buildValueTxt(e){let t=document.createElement("div");return t.classList.add("form-control","rounded-top-0"),t.innerText=e,t}let res,apiSrv=window.location.pathname,password_value=document.querySelector("#passwordText").value,buildValueItemFunc=buildValueTxt;document.addEventListener("DOMContentLoaded",function(){var e=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));e.map(function(e){return new bootstrap.Popover(e)});loadUrlList()});